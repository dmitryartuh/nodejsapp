/**
 * Created by User on 22.11.2015.
 */
module.exports.create_new_game_session = function(id, user_id1){
    var game_session = {};
    game_session.id = id;
    game_session.users_id = [
        user_id1
    ];
    game_session.state = [
        [-1, -1, -1],
        [-1, -1, -1],
        [-1, -1, -1]
    ];
    game_session.current_user = user_id1;
    game_session.current_user_num = 0;
    game_session.finished = false;
    game_session.started = false;

    game_session.add_user = function(userid){
        this.users_id.push(userid);
        this.started = true;
    };

    game_session.get_winner = function(){
        return this.users_id[this.current_user_num];
    }

    game_session.get_losser = function(){
        return this.users_id[1 - this.current_user_num];
    }

    game_session.set_step = function(data){
        if(data.x == undefined || data.x == null || data.y == undefined || data.y == null){
            return false;
        }
        if(data.x >= 0 && data.x <3 && data.y >= 0 && data.y < 3){
            this.state[data.x][data.y] = this.current_user_num;
        }
        else{
            return false;
        }

        return true;
    }

    game_session.next_step = function(){
        if(this.check(this.state)){
            return false;
        }
        this.current_user_num = 1 - this.current_user_num;
        this.current_user = this.users_id[this.current_user_num];

        return true;
    }

    game_session.check = function(arr){
        var win_x = true;
        for (var i = 0; i < 3; i++) {
            for (var j = 1; j < 3; j++){
                if(arr[i][j - 1] != arr[i][j] || arr[i][j - 1] == -1 || arr[i][j] == -1){
                    win_x = false;
                    break;
                }
            }
            if(win_x){
                break;
            }
        }

        var win_y = true;
        for (i = 0; i < 3; i++) {
            for (j = 1; j < 3; j++) {
                if (arr[j - 1][i] != arr[j][i] || arr[i][j - 1] == -1 || arr[i][j] == -1) {
                    win_y = false;
                    break;
                }
            }
            if (win_y) {
                break;
            }
        }

        var win_xy = (arr[0][0] == arr[1][1] == arr[2][2] && arr[0][0] != -1);

        var win_yx = (arr[0][2] == arr[1][1] == arr[2][0] && arr[0][2] != -1);

        return win_x || win_y || win_xy || win_yx;
    }

    return game_session;
};