/**
 * Created by User on 23.11.2015.
 */
var config = require('config');
var http = require('http');
var active_workers = [];

for (var item in config.workers) {

}
config.workers.data.forEach(function(item) {
    http.get(item.address + config.workers.api.check_url, function(res) {
        console.log(item.address + ' works');
        active_workers.push({
            url: item.address,
            count:0
        });
    }).on('error', function(e) {
        console.log(item.address + ' doesn\'t works');
    });

});

exports.get_worker = function(){
    if(active_workers.length > 0) {
        var worker = active_workers[0];
        active_workers.forEach(function(item){
            if(item.count < worker.count){
                worker = item;
            }
        });
        worker.count ++;
        return worker.url;
    }
    else{
        return null;
    }
};